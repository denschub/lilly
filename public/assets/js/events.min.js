var Events=function(){var t=[],e=t.slice,n={on:function(t,e,n){if(!s(this,"on",t,[e,n])||!e)return this;this._events||(this._events={});var i=this._events[t]||(this._events[t]=[]);return i.push({callback:e,context:n,ctx:n||this}),this},once:function(t,e,n){if(!s(this,"once",t,[e,n])||!e)return this;var i=this,r=_.once(function(){i.off(t,r),e.apply(this,arguments)});return r._callback=e,this.on(t,r,n)},off:function(t,e,n){var i,r,c,l,a,h,o,f;if(!this._events||!s(this,"off",t,[e,n]))return this;if(!t&&!e&&!n)return this._events=void 0,this;for(l=t?[t]:_.keys(this._events),a=0,h=l.length;h>a;a++)if(t=l[a],c=this._events[t]){if(this._events[t]=i=[],e||n)for(o=0,f=c.length;f>o;o++)r=c[o],(e&&e!==r.callback&&e!==r.callback._callback||n&&n!==r.context)&&i.push(r);i.length||delete this._events[t]}return this},trigger:function(t){if(!this._events)return this;var n=e.call(arguments,1);if(!s(this,"trigger",t,n))return this;var i=this._events[t],c=this._events.all;return i&&r(i,n),c&&r(c,arguments),this},stopListening:function(t,e,n){var i=this._listeningTo;if(!i)return this;var s=!e&&!n;n||"object"!=typeof e||(n=this),t&&((i={})[t._listenId]=t);for(var r in i)t=i[r],t.off(e,n,this),(s||_.isEmpty(t._events))&&delete this._listeningTo[r];return this}},i=/\s+/,s=function(t,e,n,s){if(!n)return!0;if("object"==typeof n){for(var r in n)t[e].apply(t,[r,n[r]].concat(s));return!1}if(i.test(n)){for(var c=n.split(i),l=0,a=c.length;a>l;l++)t[e].apply(t,[c[l]].concat(s));return!1}return!0},r=function(t,e){var n,i=-1,s=t.length,r=e[0],c=e[1],l=e[2];switch(e.length){case 0:for(;++i<s;)(n=t[i]).callback.call(n.ctx);return;case 1:for(;++i<s;)(n=t[i]).callback.call(n.ctx,r);return;case 2:for(;++i<s;)(n=t[i]).callback.call(n.ctx,r,c);return;case 3:for(;++i<s;)(n=t[i]).callback.call(n.ctx,r,c,l);return;default:for(;++i<s;)(n=t[i]).callback.apply(n.ctx,e);return}},c={listenTo:"on",listenToOnce:"once"};return _.each(c,function(t,e){n[e]=function(e,n,i){var s=this._listeningTo||(this._listeningTo={}),r=e._listenId||(e._listenId=_.uniqueId("l"));return s[r]=e,i||"object"!=typeof n||(i=this),e[t](n,i,this),this}}),n}();